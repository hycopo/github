<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ギター弦テンション・シミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A two-column dashboard layout. The left column contains all user controls (scale, gauge sets, individual gauges, tuning) for a clear, task-oriented workflow. The right column dynamically displays all results (summary card for total tension and feel, a detailed data table, and a bar chart for tension balance). This separation of input and output provides an intuitive and immediate feedback loop, making it easy for users to experiment with different setups and understand the consequences instantly. -->
    <!-- Visualization & Content Choices: Total tension is shown in a prominent, color-coded card for at-a-glance understanding of the qualitative 'feel'. A standard HTML table presents detailed per-string data for precise analysis. A Chart.js horizontal bar chart visualizes the tension balance across strings, making it easier to spot inconsistencies than reading raw numbers. This combination serves both novice users (with the summary card) and advanced users (with the table and chart). A conditional warning message for drastic tension changes provides crucial, context-aware advice. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .control-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #6B7280;
            margin-bottom: 0.5rem;
        }
        .form-select, .form-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #D1D5DB;
            background-color: #FFFFFF;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #A5937D;
            box-shadow: 0 0 0 3px rgba(165, 147, 125, 0.2);
        }
        .card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #F3F4F6;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 300px;
                max-height: 350px;
            }
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-[#3A3A3A]">ギター弦テンション・シミュレーター</h1>
            <p class="mt-2 text-md text-gray-600 max-w-2xl mx-auto">あなたのギターに最適な弦の組み合わせを見つけ、理想の「弾き心地」を実現しましょう。</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Controls -->
            <div class="lg:col-span-1 space-y-6">
                <div class="card">
                    <h2 class="text-xl font-semibold mb-4 text-[#3A3A3A]">1. ギターの仕様</h2>
                    <div>
                        <label for="scale-length" class="control-label block">スケール長 (インチ)</label>
                        <div class="flex items-center space-x-2">
                             <select id="scale-length-preset" class="form-select">
                                <option value="25.5">25.5" (Fender)</option>
                                <option value="24.75">24.75" (Gibson)</option>
                                <option value="25.0">25.0" (PRS)</option>
                                <option value="custom">カスタム</option>
                            </select>
                            <input type="number" id="scale-length-custom" class="form-input hidden" value="25.5" step="0.01" min="20" max="35">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="text-xl font-semibold mb-4 text-[#3A3A3A]">2. 弦のゲージ</h2>
                    <div>
                        <label for="gauge-set" class="control-label block">プリセット</label>
                        <select id="gauge-set" class="form-select mb-4">
                            <option value="custom">カスタム...</option>
                            <option value="super-light">Super Light Strings (9-42)</option>
                            <option value="custom-light">Custom Light Strings (9-46)</option>
                            <option value="light" selected>Light Strings (10-46)</option>
                            <option value="light-heavy">Light-Heavy Strings (10-52)</option>
                            <option value="medium">Medium Strings (11-49)</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-3 gap-x-4 gap-y-3">
                        <!-- Individual String Gauges -->
                        <div class="col-span-1"><label class="control-label">6弦</label><select id="gauge-6" class="form-select gauge-input"></select></div>
                        <div class="col-span-1"><label class="control-label">5弦</label><select id="gauge-5" class="form-select gauge-input"></select></div>
                        <div class="col-span-1"><label class="control-label">4弦</label><select id="gauge-4" class="form-select gauge-input"></select></div>
                        <div class="col-span-1"><label class="control-label">3弦</label><select id="gauge-3" class="form-select gauge-input"></select></div>
                        <div class="col-span-1"><label class="control-label">2弦</label><select id="gauge-2" class="form-select gauge-input"></select></div>
                        <div class="col-span-1"><label class="control-label">1弦</label><select id="gauge-1" class="form-select gauge-input"></select></div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="text-xl font-semibold mb-4 text-[#3A3A3A]">3. チューニング</h2>
                    <div>
                        <label for="tuning" class="control-label block">チューニングを選択</label>
                        <select id="tuning" class="form-select">
                            <option value="regular" selected>レギュラー (EADGBe)</option>
                            <option value="half-down">半音下げ (EbAbDbGbBbEb)</option>
                            <option value="drop-d">ドロップD (DADGBe)</option>
                            <option value="drop-c-sharp">ドロップC# (C#G#C#F#A#D#)</option>
                            <option value="drop-c">ドロップC (CGCFAD)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Summary Card -->
                <div id="summary-card" class="card text-center transition-all duration-300">
                    <p class="text-lg font-medium text-gray-600">トータルテンション</p>
                    <p id="total-tension" class="text-5xl font-bold my-2">-- lbs</p>
                    <div class="flex justify-center items-center space-x-4">
                        <p id="total-tension-kg" class="text-lg text-gray-500">-- kg</p>
                        <span id="feel-badge" class="px-4 py-1.5 text-lg font-semibold rounded-full transition-all duration-300">--</span>
                    </div>
                </div>

                <!-- Warning Message -->
                <div id="warning-message" class="hidden p-4 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-800">
                    <p class="font-semibold">ネック調整に関する注意</p>
                    <p class="text-sm">現在の設定は、標準的なテンションから大きく変化します。ギターのネックの状態を最適に保つため、トラスロッドの調整が必要になる可能性があります。不明な場合は専門家にご相談ください。</p>
                </div>
                
                <!-- Detailed Results Table -->
                <div class="card">
                    <h3 class="text-xl font-semibold mb-4 text-[#3A3A3A]">各弦のテンション詳細</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b">
                                    <th class="p-3 font-medium text-gray-500">弦</th>
                                    <th class="p-3 font-medium text-gray-500">音名</th>
                                    <th class="p-3 font-medium text-gray-500">ゲージ</th>
                                    <th class="p-3 font-medium text-gray-500 text-right">テンション (lbs)</th>
                                    <th class="p-3 font-medium text-gray-500 text-right">テンション (kg)</th>
                                </tr>
                            </thead>
                            <tbody id="results-table">
                                <!-- Rows will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tension Balance Chart -->
                <div class="card">
                    <h3 class="text-xl font-semibold mb-4 text-[#3A3A3A]">テンションバランス・チャート</h3>
                    <p class="text-sm text-gray-600 mb-4">各弦のテンションのばらつきを視覚的に確認できます。バランスの取れたセットは、一般的に弾き心地が均一になります。</p>
                    <div class="chart-container">
                        <canvas id="tensionChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const DATA = {
                unitWeights: {
                    ".009": 0.0000175, ".010": 0.0000219, ".011": 0.0000262, ".012": 0.0000315,
                    ".013": 0.0000365, ".016": 0.0000559, ".017": 0.0000636, ".024": 0.0001050,
                    ".026": 0.0001245, ".032": 0.0001860, ".036": 0.0002350, ".042": 0.0003150,
                    ".046": 0.0003780, ".049": 0.0004350, ".052": 0.0004900, ".056": 0.0005700,
                },
                frequencies: {
                    regular:     { freqs: [82.41, 110.00, 146.83, 196.00, 246.94, 329.63], notes: ['E', 'A', 'D', 'G', 'B', 'E'] },
                    'half-down': { freqs: [77.78, 103.83, 138.59, 185.00, 233.08, 311.13], notes: ['Eb', 'Ab', 'Db', 'Gb', 'Bb', 'Eb'] },
                    'drop-d':    { freqs: [73.42, 110.00, 146.83, 196.00, 246.94, 329.63], notes: ['D', 'A', 'D', 'G', 'B', 'E'] },
                    'drop-c-sharp':{ freqs: [69.30, 103.83, 138.59, 185.00, 233.08, 311.13], notes: ['C#', 'G#', 'C#', 'F#', 'A#', 'D#'] },
                    'drop-c':    { freqs: [65.41, 98.00, 130.81, 174.61, 220.00, 293.66], notes: ['C', 'G', 'C', 'F', 'A', 'D'] },
                },
                gaugeSets: {
                    'super-light':   ['.042', '.032', '.024', '.016', '.011', '.009'],
                    'custom-light':  ['.046', '.036', '.026', '.016', '.011', '.009'],
                    'light':         ['.046', '.036', '.026', '.017', '.013', '.010'],
                    'light-heavy':   ['.052', '.042', '.032', '.017', '.013', '.010'],
                    'medium':        ['.049', '.036', '.026', '.017', '.013', '.011'],
                },
                feelThresholds: [
                    { limit: 80, label: '非常に緩い', badge: 'bg-blue-100 text-blue-800', card: 'bg-blue-50' },
                    { limit: 95, label: '緩い', badge: 'bg-cyan-100 text-cyan-800', card: 'bg-cyan-50' },
                    { limit: 110, label: '標準', badge: 'bg-green-100 text-green-800', card: 'bg-green-50' },
                    { limit: 125, label: '硬い', badge: 'bg-orange-100 text-orange-800', card: 'bg-orange-50' },
                    { limit: Infinity, label: '非常に硬い', badge: 'bg-red-100 text-red-800', card: 'bg-red-50' },
                ]
            };

            const GRAVITY_CONST = 386.4;
            const LBS_TO_KG = 0.453592;

            const scaleLengthPresetEl = document.getElementById('scale-length-preset');
            const scaleLengthCustomEl = document.getElementById('scale-length-custom');
            const gaugeSetEl = document.getElementById('gauge-set');
            const tuningEl = document.getElementById('tuning');
            const gaugeInputs = Array.from(document.querySelectorAll('.gauge-input')).reverse(); // 1 to 6
            const resultsTableEl = document.getElementById('results-table');
            const totalTensionEl = document.getElementById('total-tension');
            const totalTensionKgEl = document.getElementById('total-tension-kg');
            const feelBadgeEl = document.getElementById('feel-badge');
            const summaryCardEl = document.getElementById('summary-card');
            const warningMessageEl = document.getElementById('warning-message');

            let tensionChart;

            function populateGaugeSelectors() {
                const gauges = Object.keys(DATA.unitWeights);
                gaugeInputs.forEach(select => {
                    select.innerHTML = '';
                    gauges.forEach(gauge => {
                        const option = document.createElement('option');
                        option.value = gauge;
                        option.textContent = gauge.substring(1);
                        select.appendChild(option);
                    });
                });
            }

            function setGaugesFromPreset(presetKey) {
                if (presetKey === 'custom' || !DATA.gaugeSets[presetKey]) return;
                const set = DATA.gaugeSets[presetKey];
                gaugeInputs.forEach((select, i) => {
                    select.value = set[i];
                });
            }

            function calculateAndDisplay() {
                const scaleLength = getScaleLength();
                const tuningKey = tuningEl.value;
                const currentGauges = gaugeInputs.map(select => select.value);
                const tuningData = DATA.frequencies[tuningKey];
                const freqs = tuningData.freqs;
                const notes = tuningData.notes;

                let totalTensionLbs = 0;
                const tensionResults = [];

                for (let i = 0; i < 6; i++) {
                    const stringNum = 6 - i;
                    const gauge = currentGauges[i];
                    const unitWeight = DATA.unitWeights[gauge];
                    const frequency = freqs[i];
                    
                    const tensionLbs = (unitWeight * Math.pow(2 * scaleLength * frequency, 2)) / GRAVITY_CONST;
                    totalTensionLbs += tensionLbs;

                    tensionResults.push({
                        string: stringNum,
                        note: notes[i],
                        gauge: gauge.substring(1),
                        tensionLbs: tensionLbs,
                        tensionKg: tensionLbs * LBS_TO_KG
                    });
                }
                
                updateUI(tensionResults, totalTensionLbs);
            }
            
            function getScaleLength() {
                return scaleLengthPresetEl.value === 'custom'
                    ? parseFloat(scaleLengthCustomEl.value) || 25.5
                    : parseFloat(scaleLengthPresetEl.value);
            }

            function updateUI(results, totalTensionLbs) {
                resultsTableEl.innerHTML = '';
                results.forEach(res => { // results is already [str6, str5, ...], which is the desired display order
                    const row = document.createElement('tr');
                    row.className = 'border-b last:border-b-0';
                    row.innerHTML = `
                        <td class="p-3">${res.string}</td>
                        <td class="p-3">${res.note}</td>
                        <td class="p-3">${res.gauge}</td>
                        <td class="p-3 text-right font-medium">${res.tensionLbs.toFixed(2)}</td>
                        <td class="p-3 text-right text-gray-500">${res.tensionKg.toFixed(2)}</td>
                    `;
                    resultsTableEl.appendChild(row);
                });

                totalTensionEl.textContent = `${totalTensionLbs.toFixed(2)} lbs`;
                totalTensionKgEl.textContent = `${(totalTensionLbs * LBS_TO_KG).toFixed(2)} kg`;

                const feel = DATA.feelThresholds.find(f => totalTensionLbs < f.limit);
                feelBadgeEl.textContent = feel.label;
                
                feelBadgeEl.className = `px-4 py-1.5 text-lg font-semibold rounded-full transition-all duration-300 ${feel.badge}`;
                summaryCardEl.className = `card text-center transition-all duration-300 ${feel.card}`;

                if (totalTensionLbs < 90 || totalTensionLbs > 115) {
                    warningMessageEl.classList.remove('hidden');
                } else {
                    warningMessageEl.classList.add('hidden');
                }

                updateChart(results);
            }

            function createChart() {
                const ctx = document.getElementById('tensionChart').getContext('2d');
                tensionChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['6弦', '5弦', '4弦', '3弦', '2弦', '1弦'],
                        datasets: [{
                            label: 'テンション (lbs)',
                            data: [],
                            backgroundColor: 'rgba(165, 147, 125, 0.6)',
                            borderColor: 'rgba(165, 147, 125, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'テンション (lbs)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.x !== null) {
                                            label += context.parsed.x.toFixed(2) + ' lbs';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            function updateChart(results) {
                if (!tensionChart) return;
                // The results array is already in [str6, str5, ...] order, matching the chart labels.
                tensionChart.data.datasets[0].data = results.map(r => r.tensionLbs);
                tensionChart.update();
            }

            function addEventListeners() {
                scaleLengthPresetEl.addEventListener('change', (e) => {
                    if (e.target.value === 'custom') {
                        scaleLengthCustomEl.classList.remove('hidden');
                        scaleLengthCustomEl.focus();
                    } else {
                        scaleLengthCustomEl.classList.add('hidden');
                    }
                    calculateAndDisplay();
                });
                scaleLengthCustomEl.addEventListener('input', calculateAndDisplay);
                
                gaugeSetEl.addEventListener('change', (e) => {
                    setGaugesFromPreset(e.target.value);
                    calculateAndDisplay();
                });

                tuningEl.addEventListener('change', calculateAndDisplay);
                gaugeInputs.forEach(input => input.addEventListener('change', () => {
                    gaugeSetEl.value = 'custom';
                    calculateAndDisplay();
                }));
            }

            function initialize() {
                populateGaugeSelectors();
                setGaugesFromPreset('light');
                createChart();
                addEventListeners();
                calculateAndDisplay();
            }

            initialize();
        });
    </script>

</body>
</html>
